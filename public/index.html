<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ó–∞–≥—Ä—É–∑–∏—Ç—å –≤–∏–¥–µ–æ</title>
    <link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
</head>
<body>
    <div class="container">
        <div class="card">
            <h1>–ó–∞–≥—Ä—É–∑–∏—Ç–µ –≤–∏–¥–µ–æ</h1>
            <p class="subtitle">–í—ã–±–µ—Ä–∏—Ç–µ –≤–∏–¥–µ–æ –¥–æ 60 —Å–µ–∫—É–Ω–¥, —á—Ç–æ–±—ã –ø—Ä–µ–≤—Ä–∞—Ç–∏—Ç—å –µ–≥–æ –≤ –∫—Ä—É–∂–æ–∫.</p>
            <input type="file" id="videoInput" accept="video/*" hidden>
            <label for="videoInput" class="upload-button">
                <span id="uploadText">–í—ã–±—Ä–∞—Ç—å –≤–∏–¥–µ–æ</span>
                <span id="uploadIcon">üìÅ</span>
            </label>
            <div id="progressBar" class="progress-bar">
                <div id="progress" class="progress"></div>
            </div>
            <button id="uploadButton" class="submit-button" disabled>–°–æ–∑–¥–∞—Ç—å –∫—Ä—É–∂–æ–∫</button>
            <div id="status" class="status-message"></div>
        </div>
    </div>

    <script>
        const videoInput = document.getElementById('videoInput');
        const uploadButton = document.getElementById('uploadButton');
        const uploadText = document.getElementById('uploadText');
        const uploadIcon = document.getElementById('uploadIcon');
        const progressBar = document.getElementById('progressBar');
        const progress = document.getElementById('progress');
        const statusMessage = document.getElementById('status');

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤—ã–±–æ—Ä–∞ —Ñ–∞–π–ª–∞
        videoInput.addEventListener('change', () => {
            const file = videoInput.files[0];
            if (file) {
                if (file.size > 100 * 1024 * 1024) { // –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –Ω–∞ —Ä–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞ (100 –ú–ë)
                    statusMessage.innerText = "–§–∞–π–ª —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–π. –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä ‚Äî 100 –ú–ë.";
                    statusMessage.style.color = "#ff4d4d";
                    uploadButton.disabled = true;
                    return;
                }

                if (file.type.startsWith('video/')) {
                    uploadText.innerText = file.name;
                    uploadIcon.innerText = "‚úîÔ∏è";
                    uploadButton.disabled = false;
                    statusMessage.innerText = "";
                } else {
                    statusMessage.innerText = "–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ –≤–∏–¥–µ–æ—Ñ–∞–π–ª.";
                    statusMessage.style.color = "#ff4d4d";
                    uploadButton.disabled = true;
                }
            }
        });

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏
        uploadButton.addEventListener('click', async () => {
            const file = videoInput.files[0];
            if (!file) {
                statusMessage.innerText = "–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ –≤–∏–¥–µ–æ.";
                statusMessage.style.color = "#ff4d4d";
                return;
            }

            const formData = new FormData();
            formData.append('video', file);

            try {
                uploadButton.disabled = true;
                statusMessage.innerText = "–ó–∞–≥—Ä—É–∑–∫–∞...";
                statusMessage.style.color = "#333";

                const response = await fetch('/api/upload', {
                    method: 'POST',
                    body: formData
                });

                const data = await response.json();
                if (data.success) {
                    statusMessage.innerText = "–í–∏–¥–µ–æ –∑–∞–≥—Ä—É–∂–µ–Ω–æ! –û–±—Ä–∞–±–æ—Ç–∫–∞...";
                    statusMessage.style.color = "#4CAF50";

                    // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º URL –≤–∏–¥–µ–æ –±–æ—Ç—É —á–µ—Ä–µ–∑ WebApp
                    Telegram.WebApp.sendData(JSON.stringify({ file_url: data.file_url }));
                    Telegram.WebApp.close();
                } else {
                    throw new Error(data.message || "–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –≤–∏–¥–µ–æ.");
                }
            } catch (error) {
                statusMessage.innerText = error.message;
                statusMessage.style.color = "#ff4d4d";
                uploadButton.disabled = false;
            }
        });
    </script>
</body>
</html>